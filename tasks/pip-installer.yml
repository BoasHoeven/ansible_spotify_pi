---
- name: Check to see if pip is already installed.
  command: "pip --version"
  ignore_errors: true
  changed_when: false
  check_mode: false
  register: pip_installed

- name: Install pip
  get_url:
    url: https://bootstrap.pypa.io/get-pip.py
    dest: /tmp/get-pip.py
    mode: '0755'
  become: true
  when: pip_installed.rc != 0

- name: Extract major and minor version numbers from Python version string
  set_fact:
    python_version_major_minor: "{{ python_version.split('.')[0:2] | join('.') }}"

- name: Run get-pip.py script
  command: "python{{ python_version_major_minor }} /tmp/get-pip.py"
  become: true
  when: pip_installed.rc != 0